# TheLawSays ⚖️

**Your AI legal assistant for instant Nigerian law answers**

TheLawSays gives you instant access to Nigerian legal knowledge and advice. Ask questions about Federal and Lagos State laws to get accurate, cited answers in seconds.

Skip the complex legal databases and get clear guidance on:
• Criminal law and justice procedures
• Business regulations and compliance
• Employment and labor rights
• Property and tenancy matters
• Digital rights and data protection

**Fast • Reliable • Always available when you need legal clarity**

## How It Works (Smart Conditional RAG Pipeline)

```mermaid
graph TD
    A[laws_pdfs/*.pdf] --> B[Tika + OCR]
    B --> C[Chunk + Clean]
    C --> D[documents.json]
    C --> E[BM25 → bm25_index.pkl]
    C --> F[MiniLM → embeddings → FAISS]
    F --> G[legal_index.faiss compressed]

    H[User Query] --> I{Conversational Query?}

    I -->|YES "hi", "thanks"| J[Simple Response]
    J --> K[Answer with greeting]

    I -->|NO Legal Question| L[Hybrid: FAISS + BM25]
    L --> M[Retrieved chunks from documents.json]
    M --> N[Prompt + OpenAI + Context]
    N --> O[Answer with legal citations]

    K --> P[No RAG execution]
    O --> Q[RAG execution = citations shown]
```

**Smart conditional process:**
1. **Query Analysis**: Automatically detects conversational queries ("hi", "thanks", "who created you") vs legal questions
2. **Conditional Routing**: Conversational queries get fast, simple responses (80% token savings)
3. **Legal Processing**: Only legal questions trigger full RAG retrieval
4. **Data Ingestion**: Legal PDFs processed with Apache Tika + OCR fallback
5. **Intelligent Indexing**: Hybrid BM25 + FAISS system for optimal retrieval
6. **Citation Generation**: Legal answers include proper citations and jurisdiction clarification

## Features
- Hybrid retrieval (FAISS vectors + BM25) across chunked legal PDFs
- OCR fallback for scanned documents (Tesseract + pdf2image)
- Streamlit chat interface with optional jurisdiction filters
- Structured prompts that enforce citations and limit hallucinations

## Project Structure

```
.
├── app.py               # Streamlit chat front-end
├── build_index.py       # Pipeline that extracts, chunks, embeds, and indexes PDFs
├── laws/                # Place federal/lagos PDF statutes here
├── documents.json       # Chunk store generated by build_index.py
├── legal_index.faiss    # FAISS vector index (generated)
├── bm25_index.pkl       # BM25 lexical index (generated)
├── requirements.txt     # Python dependencies
└── RAG_pipeline.md      # High-level pipeline diagram
```

## Prerequisites

- Python 3.10+
- Poppler (for `pdf2image`) available on your PATH
- Tesseract OCR
- Java (for Apache Tika)
- OpenAI API key (set as `OPENAI_API_KEY` in `.streamlit/secrets.toml`)

Install Python dependencies:

```bash
pip install -r requirements.txt
python -m spacy download en_core_web_sm
```

Ensure the OCR and PDF helpers are installed:

- **Windows:** install Tesseract from <https://github.com/tesseract-ocr/tesseract>, Poppler from <https://github.com/oschwartz10612/poppler-windows>, and add both to PATH.
- **macOS:** `brew install tesseract poppler`.
- **Linux:** install via your package manager (e.g. `sudo apt install tesseract-ocr poppler-utils`).

## Preparing the Knowledge Base

1. Copy your statutes into `laws/federal/` and `laws/lagos/` (PDF format).
2. Run the indexing pipeline:

   ```bash
   python build_index.py
   ```

   The script will:

   - Extract text with Tika and OCR fallback
   - Chunk and deduplicate passages
   - Generate sentence embeddings (MiniLM) and build a cosine-similarity FAISS index
   - Build a BM25 lexical index
   - Persist chunks to `documents.json`

   If the script reports missing dependencies, install them and rerun.

## Running the App

```bash
streamlit run app.py
```

Use the sidebar to pick a jurisdiction filter (Auto, Federal, Lagos) and control how many excerpts are retrieved. The chat interface retrieves hybrid results, builds a citation-focused prompt, and asks OpenAI for an answer. If you have not supplied an API key, the app will prompt you to add one.

## Troubleshooting

- **`Missing knowledge base files`**: Run `python build_index.py` after placing PDFs in `laws/`.
- **`No chunks were generated`**: Confirm the PDFs contain extractable text; the script logs when it falls back to OCR.
- **`poppler not found` / `OSError: Unable to get page count.`**: Install Poppler and ensure `pdftoppm` is on PATH.
- **`OpenAI error` messages in the chat**: Check network connectivity, your API quota, and the key stored in `.streamlit/secrets.toml`.

## Future Improvements

- Add automated evaluation of retrieval quality
- Support more jurisdictions by extending the directory structure
- Cache OCR output to avoid reprocessing large scans

---

Built with Tika, pdf2image, Tesseract, FAISS, sentence-transformers, BM25, and OpenAI.
